---
#
# Select what to install by specifying a tag
# - backend - to install backend
# - frontend - to install frontend
#
- name: Load external variables from a file
  include_vars:
    file: demoapp_ansible_vars.yml
  tags:
    - always

##
## Install backend or/and frontend
##
- name: Install application
  block:

    - import_tasks: install_backend.yml
      vars:
        base_dir: "../demoapp/"
      tags: [ "backend" ]
    - import_tasks: install_frontend.yml
      tags: [ "frontend" ]
    - meta: end_play

  rescue:

    - import_tasks: uninstall_backend.yml
      tags: [ "backend" ]
    - import_tasks: uninstall_frontend.yml
      tags: [ "frontend" ]
    - meta: end_play

  when: do in [ "install" ]


##
## Uninstall backend or/and frontend
##
- name: Uninstall application
  block:

    - import_tasks: uninstall_backend.yml
      tags: [ "backend" ]
    - import_tasks: uninstall_frontend.yml
      tags: [ "frontend" ]
    - meta: end_play

  when: do in [ "uninstall" ]

